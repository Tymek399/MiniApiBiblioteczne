<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Obsługa API Biblioteki</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .error-message { color: red; }
        .success-message { color: green; }
        .info-message { color: blue; }
    </style>
</head>
<body class="bg-gray-100 p-6">
<h1 class="text-3xl font-semibold text-center text-blue-700 mb-8">Obsługa API Biblioteki</h1>
<div class="container mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Książki</h2>
        <form id="addBookForm" class="flex flex-col space-y-4">
            <label for="title" class="block text-gray-600 text-sm font-bold mb-2">Tytuł:</label>
            <input type="text" id="title" name="title" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <label for="author" class="block text-gray-600 text-sm font-bold mb-2">Autor:</label>
            <input type="text" id="author" name="author" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <label for="isbn" class="block text-gray-600 text-sm font-bold mb-2">ISBN:</label>
            <input type="text" id="isbn" name="isbn" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <label for="publicationYear" class="block text-gray-600 text-sm font-bold mb-2">Rok:</label>
            <input type="number" id="publicationYear" name="publicationYear" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Dodaj</button>
            <div id="addBookMessage" class="mt-4 text-yellow-600 font-semibold"></div>
        </form>
        <form id="getBookByIdForm" class="flex flex-col space-y-4">
            <label for="bookId" class="block text-gray-600 text-sm font-bold mb-2">ID Książki:</label>
            <input type="number" id="bookId" name="bookId" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Pobierz</button>
            <div id="getBookByIdMessage" class="mt-4 text-yellow-600 font-semibold"></div>
        </form>
        <form id="searchBooksForm" class="flex flex-col space-y-4">
            <label for="searchTitle" class="block text-gray-600 text-sm font-bold mb-2">Tytuł:</label>
            <input type="text" id="searchTitle" name="title" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <label for="searchAuthor" class="block text-gray-600 text-sm font-bold mb-2">Autor:</label>
            <input type="text" id="searchAuthor" name="author" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <button type="submit" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Szukaj</button>
            <div id="searchBooksMessage" class="mt-4 text-yellow-600 font-semibold"></div>
        </form>
    </div>
    <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Wypożyczenia</h2>
        <form id="borrowBookForm" class="flex flex-col space-y-4">
            <label for="borrowUserId" class="block text-gray-600 text-sm font-bold mb-2">ID Użytkownika:</label>
            <input type="number" id="borrowUserId" name="userId" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <label for="borrowBookId" class="block text-gray-600 text-sm font-bold mb-2">ID Książki:</label>
            <input type="number" id="borrowBookId" name="bookId" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <button type="submit" class="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Wypożycz</button>
            <div id="borrowBookMessage" class="mt-4 text-yellow-600 font-semibold"></div>
        </form>
        <form id="returnBookForm" class="flex flex-col space-y-4">
            <label for="returnBorrowingId" class="block text-gray-600 text-sm font-bold mb-2">ID Wypożyczenia:</label>
            <input type="number" id="returnBorrowingId" name="borrowingId" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <button type="submit" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Zwróć</button>
            <div id="returnBookMessage" class="mt-4 text-yellow-600 font-semibold"></div>
        </form>
        <form id="borrowingHistoryForm" class="flex flex-col space-y-4">
            <label for="historyUsername" class="block text-gray-600 text-sm font-bold mb-2">Nazwa Użytkownika:</label>
            <input type="text" id="historyUsername" name="username" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <button type="submit" class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Pobierz Historię</button>
            <div id="borrowingHistoryMessage" class="mt-4 text-yellow-600 font-semibold"></div>
        </form>
    </div>
</div>
<script>
    const API_BASE_URL = '/api';

    async function fetchData(url, method, body = null, headers = {}) {
        try {
            const fetchOptions = {
                method: method,
                headers: { ...headers }
            };
            if (method !== 'GET' && body !== null) {
                fetchOptions.headers['Content-Type'] = 'application/json';
                fetchOptions.body = JSON.stringify(body);
            }

            const response = await fetch(url, fetchOptions);
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
            }
            return await response.json();
        } catch (error) {
            console.error("Błąd:", error);
            throw error;
        }
    }

    function displayMessage(containerId, message, type = 'info') {
        const container = document.getElementById(containerId);
        container.textContent = message;
        container.className = `mt-4 font-semibold ${type === 'error' ? 'text-red-600' : type === 'success' ? 'text-green-600' : 'text-blue-600'}`;
    }

    function handleFormSubmit(formId, endpoint, method, dataBuilder, messageContainerId, successHandler) {
        document.getElementById(formId).addEventListener('submit', async (event) => {
            event.preventDefault();
            const data = dataBuilder();
            if (!data) return;
            try {
                const result = await fetchData(endpoint, method, data);
                successHandler(result);
                document.getElementById(formId).reset();
            } catch (error) {
                displayMessage(messageContainerId, `Błąd: ${error.message}`, 'error');
            }
        });
    }

    handleFormSubmit('addBookForm', `${API_BASE_URL}/books`, 'POST', () => {
        const title = document.getElementById('title').value;
        const author = document.getElementById('author').value;
        const isbn = document.getElementById('isbn').value;
        const publicationYear = document.getElementById('publicationYear').value;
        if (!title || !author || !isbn || !publicationYear) {
            displayMessage('addBookMessage', "Wypełnij wszystkie pola!", 'error');
            return null;
        }
        return { title, author, isbn, publicationYear };
    }, 'addBookMessage', () => displayMessage('addBookMessage', "Książka dodana pomyślnie!", 'success'));

    document.getElementById('getBookByIdForm').addEventListener('submit', async (event) => {
        event.preventDefault();
        const bookId = document.getElementById('bookId').value;
        const messageContainerId = 'getBookByIdMessage';
        if (!bookId) {
            displayMessage(messageContainerId, "Podaj ID książki!", 'error');
            return;
        }
        try {
            const data = await fetchData(`${API_BASE_URL}/books/${bookId}`, 'GET');
            displayMessage(messageContainerId, JSON.stringify(data, null, 2), 'success');
        } catch (error) {
            displayMessage(messageContainerId, `Błąd: ${error.message}`, 'error');
        }
    });

    document.getElementById('searchBooksForm').addEventListener('submit', async (event) => {
        event.preventDefault();
        const title = document.getElementById('searchTitle').value;
        const author = document.getElementById('searchAuthor').value;
        const messageContainerId = 'searchBooksMessage';
        let url = `${API_BASE_URL}/books/search?`;
        const params = new URLSearchParams();
        if (title) params.append('title', title);
        if (author) params.append('author', author);
        const queryString = params.toString();
        const finalUrl = queryString ? `${url}${queryString}` : `${API_BASE_URL}/books/search`;

        try {
            const data = await fetchData(finalUrl, 'GET');
            displayMessage(messageContainerId, JSON.stringify(data, null, 2), 'success');
        } catch (error) {
            displayMessage(messageContainerId, `Błąd: ${error.message}`, 'error');
        }
    });

    handleFormSubmit('borrowBookForm', `${API_BASE_URL}/borrowings/borrow`, 'POST', () => {
        const userId = document.getElementById('borrowUserId').value;
        const bookId = document.getElementById('borrowBookId').value;
        if (!userId || !bookId) {
            displayMessage('borrowBookMessage', "Podaj ID użytkownika i ID książki!", 'error');
            return null;
        }
        return { userId, bookId };
    }, 'borrowBookMessage', (data) => displayMessage('borrowBookMessage', `Wypożyczono! ID: ${data.id}, Data wypożyczenia: ${data.borrowDate}, Data zwrotu: ${data.dueDate}`, 'success'));

    handleFormSubmit('returnBookForm', `${API_BASE_URL}/borrowings/return/{borrowingId}`, 'POST', () => {
        const borrowingId = document.getElementById('returnBorrowingId').value;
        if (!borrowingId) {
            displayMessage('returnBookMessage', "Podaj ID wypożyczenia!", 'error');
            return null;
        }
        return { borrowingId };
    }, 'returnBookMessage', (data) => displayMessage('returnBookMessage', `Zwrócono! Data zwrotu: ${data.returnDate}`, 'success'));

    document.getElementById('borrowingHistoryForm').addEventListener('submit', async (event) => {
        event.preventDefault();
        const username = document.getElementById('historyUsername').value;
        const messageContainerId = 'borrowingHistoryMessage';
        if (!username) {
            displayMessage(messageContainerId, "Podaj nazwę użytkownika!", 'error');
            return;
        }
        try {
            const data = await fetchData(`${API_BASE_URL}/borrowings/history?username=${username}`, 'GET');
            displayMessage(messageContainerId, JSON.stringify(data, null, 2), 'success');
        } catch (error) {
            displayMessage(messageContainerId, `Błąd: ${error.message}`, 'error');
        }
    });
</script>
</body>
</html>